#!/usr/bin/env python

"""
Usage:
    market <code>
"""

import sys

from docopt import docopt

from market import api


def intword(n):
    n = n / (1000000.0)
    if n > 1000:
        l = 'b'
        n = n / 1000
    else:
        l = 'm'
    ret = '%7.2f' % n
    return ret + l


def perc(f):
    ret = '%6.2f%%' % f
    return ret


__version__ = '0.0.1'


def main(argv):
    code = argv['<code>']

    nasdaq = api.Nasdaq()
    data = nasdaq.summary(code)

    print '%s %s' % (code.upper(), data['quote'])
    print
    print '    Market cap:', intword(data['market_cap'])
    print '    Yield:     ', perc(data['current_yield'])

    print
    print '    Income:'
    income = nasdaq.income_statement_annual(code)
    for period in income:
        print '\t', \
            period.year, \
            '  ', \
            intword(income[period]['sales']), \
            '  ', \
            intword(income[period]['earnings'])

    print
    print '    Balance sheet:'
    sheet = nasdaq.balance_sheet_annual(code)
    for period in sheet:
        print '\t', \
            period.year, \
            '  ', \
            intword(sheet[period]['total_assets']), \
            '  ', \
            intword(sheet[period]['total_liabilities']), \
            '  ', \
            intword(sheet[period]['total_equity'])

if __name__ == '__main__':
    argv = docopt(__doc__, version=__version__)
    sys.exit(main(argv))
